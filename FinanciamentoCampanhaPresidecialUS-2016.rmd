---
output:
  html_document: default
  pdf_document: default
---
Contribuições da Campanha Presidencial America em 2016, estado do TX por Daniel Teobaldo
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Carregue aqui todos os pacotes utilizados 
# na sua análise realizada neste arquivo fonte.

# Note que o parâmetro "echo" foi definido como FALSE neste código.
# Isso previne que o código apresente resultados formatados em HTML.
# Você deve definir echo=FALSE para todos os blocos de código no seu arquivo.

library(ggplot2)
library(GGally)
library(scales)
library(memisc)
library(gridExtra)
library(maptools)
library(zipcode)
library(dplyr)
```

# Introdução

Para este projeto escolhi uma das bases de dados sugeridas pela Udacity: [Financiamento da Campanha Presidencial dos EUA de 2016](http://classic.fec.gov/disclosurep/pnational.do). 

A idéia inicial era de se fazer a analise do estado de NY, no entanto havia uma discrepancia muito grande nas contibuições uma vez que o comite *"HILLARY VICTORY FUND"* foi responsável por 45% do valor financiado referente a este estado em apenas 23 das 649.460 contribuições registradas, sendo todas elas com valores acima de U$ 100.000.  Este foi o único contribuinte que realizou contribuições acima deste valor. A maior contribuição abaixo deste valor de U$ 100.000 foi de U$ 11.816,25. Poderia ser feita uma remoção dos outliers, porém esta ação traria um dataset que não representa o conjunto de dados do estado. 

```{r Carga dados NY, echo = FALSE, warning = FALSE}
# Carga dos dados
# Carga dos dados dos comites baixados do site do FEC
cmte_data <- read.delim('cm.txt', sep = '|', header = F, col.names = c("cmte_id","cmte_nm","TRES_NM",
                                                                     "CMTE_ST1","CMTE_ST1", "CMTE_CITY",
                                                                     "CMTE_ST","CMTE_ZIP","cmte_dsgn",
                                                                     "CMTE_TP","CMTE_PTY_AFFILIATION",
                                                                     "CMTE_FILING_FREQ",
                                                                     "ORG_TP","CONNECTED_ORG_NM","CAND_ID"))

cmte_data <- cmte_data[c("cmte_id","cmte_nm","cmte_dsgn")]

#Carga dos dodos de financiamento de NY
USACampaign <- read.csv('P00000001-NY.csv', header = T)
USACampaign <- left_join(USACampaign, cmte_data, by = c("cmte_id"))
rm(cmte_data)
```


```{r Analise NY, warning = FALSE}
#Verifica a distribuição dos valores de controbuições do dataset
summary(USACampaign$contb_receipt_amt)

USACampaign$contb_receipt_amt <- abs(USACampaign$contb_receipt_amt)
USACampaign$contb_range <- cut(USACampaign$contb_receipt_amt, c(0,100,500,2000,50000,max(USACampaign$contb_receipt_amt)))

#Verifica contribuintes com contribuições superiores a U$ 100.000
USACampaign[USACampaign$contb_receipt_amt >= 100000,]$contbr_nm
#Valor máximo abaixo de U$ 100.000
max(USACampaign[USACampaign$contb_receipt_amt < 100000,]$contb_receipt_amt)

sum(USACampaign[USACampaign$contbr_nm == "HILLARY VICTORY FUND - UNITEMIZED",]$contb_receipt_amt)/sum(USACampaign$contb_receipt_amt)*100

dim(USACampaign[USACampaign$contbr_nm == "HILLARY VICTORY FUND - UNITEMIZED",])

USACampaign$hillary_comitte <- ifelse(USACampaign$contbr_nm == "HILLARY VICTORY FUND - UNITEMIZED", "Y", "N")
```

Quando comparamos as contribuições do contribuinte *HILLARY VICTORY FUND - UNITEMIZED* e os demais contribuintes, vemos que o valor total das contribuições são próximos, porém as quantidade de contribuições da comite da Hillary são significamente menores.

```{r Graficos NY, echo = FALSE, warning=FALSE}

#Contribuições HILLARY VICTORY vs OTHERS - Distribuição dos valores e total de contribuição
ggplot(aes(x=hillary_comitte), 
       data = USACampaign)+
  geom_bar(stat = 'count')+
  scale_y_continuous(breaks=seq(0,700000,50000))+
  xlab("HILLARY VICTORY FUN")+
  ylab("Qtde de contribuições")+
  ggtitle('Comparação das contribuições entre comite da Hillary e outros')


#Distribuição de valores entre as faixas vs total dos valores por faixa
ggplot(aes(x=hillary_comitte, y=contb_receipt_amt/1000), 
       data = USACampaign)+
  geom_bar(stat = 'summary', fun.y = 'sum')+
  xlab("HILLARY VICTORY FUN")+
  ylab("Valor total das contribuições")+
  ggtitle('Comparação da total das contribuições (em milhares)')


```

Abaixo uma comparação entre a quantidade de contribuições realizadas por faixa de valor versus o total arrecadado.

```{r echo = FALSE}
ggplot(aes(x=contb_range), 
       data = subset(USACampaign, !is.na(contb_range)))+
  geom_bar(stat = 'count')+
  scale_y_continuous(breaks=seq(0,600000,50000))+
  scale_x_discrete(labels=c("Até 100","100-500","500-2000","2000-50000","Acima de 50000"))+
  xlab("Qtde de contribuições")+
  ylab("Candidatos")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  ggtitle('Distribuição das contribuições em NY')


ggplot(aes(x=contb_range, y=contb_receipt_amt/1000), 
       data = subset(USACampaign, !is.na(contb_range)))+
  geom_bar(stat = 'summary', fun.y = 'sum')+
  scale_y_continuous(breaks=seq(0,90000,10000))+
  scale_x_discrete(labels=c("Até 100","100-500","500-2000","2000-50000","Acima de 50000"))+
  xlab("Qtde de contribuições")+
  ylab("Candidatos")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  ggtitle('Distribuição das contribuições em NY (em milhares)')

```

É possível notar também o impacto das contribuições de valores elevados quando comparamos os quartils dos valores com e sem estas contribuições, para cada candidato.

```{r echo=FALSE}
# plotbox com e sem contribuições com valores superiores a R$ 100.000,00
ggplot(aes(y=contb_receipt_amt, x=cand_nm), 
       data = USACampaign)+
  geom_boxplot()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

ggplot(aes(y=contb_receipt_amt, x=cand_nm), 
       data = subset(USACampaign, contbr_nm != "HILLARY VICTORY FUND - UNITEMIZED"))+
  geom_boxplot()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Esta discrepancia prejudicaria a avaliação das contribuições entre os candidatos e restringiria as analises dos dados. Desta forma optei por fazer a analise das contribuições feitas pelos eleitores do estado do TX, que traz uma distribuição mais homogenea nas contribuições.

=============================================================

## Analise do dataset do estado do Texas

```{r Carga dos dados de contribuição do TX sem tratamento, echo  = FALSE}
USACampaign <- read.csv('P00000001-TX.csv', header = T, as.is = T)

# Verifica quantidade de registros com valores de contribuição negativa
dim(USACampaign[USACampaign$contb_receipt_amt < 0,])

# Verifica quantidade de registros com valores de contribuição igual a 0 (zero)
dim(USACampaign[USACampaign$contb_receipt_amt == 0,])

# Verifica a existencia de regitro diferentes para a mesma cidade, escritas de formas diferentes
table(USACampaign[substr(USACampaign$contbr_city, 1, 4) == "DALL",]$contbr_city)

```

Algumas verificações simples nesta base de dados nos aponta necessidade de tratamento das informações. Este tratamento será feito em um script a parte, em python (`tratarDados.py`). Maiores detalhes sobre este tratamentos pode ser visualizado no arquivo `Tratamento de dados.md`. 

```{r Carregar dados e resumo, echo=FALSE}
# Carregamento dos dados
USACampaign <- read.csv('P00000001-TX_tratado.csv', header = T, as.is = T)

max(USACampaign[USACampaign$contb_receipt_amt < 100000,]$contb_receipt_amt)

USACampaign$cmte_id <- as.factor(USACampaign$cmte_id)
USACampaign$cand_id <- as.factor(USACampaign$cand_id)
USACampaign$cand_nm <- as.factor(USACampaign$cand_nm)
USACampaign$contbr_occupation <- as.factor(USACampaign$contbr_occupation)
summary(USACampaign$contbr_occupation)
USACampaign$contb_receipt_dt_month <- factor(USACampaign$contb_receipt_dt_month, ordered = T, 
                                                levels=c("JAN", "FEB", "MAR", "APR", "MAY", "JUN", 
                                                         "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"))

USACampaign$contb_receipt_date <-  as.Date(USACampaign$contb_receipt_dt, "%d-%b-%y")
summary(USACampaign$contb_receipt_date)

#Detalhes do dataset
dim(USACampaign)
names(USACampaign)
str(USACampaign)
summary(USACampaign)

```

Este dataset do estado do Texas contem 548.396 observações com 28 variaveis. O dataset original (sem tratamento) contém 18 variáveis.

# Seção de Gráficos Univariados

Uma analise importante é como as contribuições estão distribuidas por candidato. Já pensando em uma analise por partido, neste gráfico já decidi classificar os candidatos. Para a difinição do partido, consideramos a classificação registrada na base de dados de candidatos obtida no site da **FEC**. 

Nesta análise percebemos que a grande maioria das contribuições se concentram nos 4 primeiros candidatos, mas é importante notar que quando ordenamos por valor total arrecadado, existe um inversão nas posições. Devido a essa inversão farei uma análise focada nos 7 candidatos com maior volume arrecada, no lugar de 5 candidatos que era a idéia inicial.

Uma analise mais detalhada desse aspecto será realizada na seção de gráficos bivariados.

```{r Distribuição por candidato, echo = FALSE}

agrupado_por_candidato <- function() {
  
  df <- USACampaign %>%
    group_by(cand_nm) %>%
    summarise(qtde = n(),
              valor_total = sum(contb_receipt_amt),
              valor_medio = mean(contb_receipt_amt))
}

USACampaign.by_candidate <- agrupado_por_candidato()

hist_cand <- function(df) {
    ggplot(aes(x=cand_nm, fill = party), 
       data = df)+
  geom_bar(stat = 'count')+
  xlab("Candidatos")+
  ylab("Qtde de contribuições")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

hist_cand_ordenado <- function(ordererd_field) {

  USACampaign.by_candidate <- arrange(USACampaign.by_candidate, desc(ordererd_field))
  USACampaign$cand_nm <- factor(USACampaign$cand_nm, USACampaign.by_candidate$cand_nm)
  hist_cand(USACampaign)
  
}

#Histograma ordenado por valor total
hist_cand_ordenado(USACampaign.by_candidate$valor_total)

#Histograma ordenado por qtde
hist_cand_ordenado(USACampaign.by_candidate$qtde)

top7_cand <- head(USACampaign.by_candidate$cand_nm, 7)

hist_cand(subset(USACampaign, cand_nm %in% top7_cand))

```

Como esperado, nota-se que a maior parte das contribuições se destinam aos candidatos democratas (DEM) e republicanos (REP), desta forma vamos considerar apenas estes 2 partidos nas analises.

```{r Distribuição das contribuições por partido, echo = FALSE}

USACampaign.rep_and_dem <- subset(USACampaign, party == "DEM" | party == "REP") 

ggplot(aes(x=party), 
       data = USACampaign.rep_and_dem)+
  geom_bar(stat = 'count')

boxplot(contb_receipt_amt ~ party, data = USACampaign.rep_and_dem, outline=FALSE)

ggplot(aes(x=party, y=contb_receipt_amt), 
       data = subset(USACampaign.rep_and_dem, 
                     contb_receipt_amt < quantile(USACampaign.rep_and_dem$contb_receipt_amt, 0.9)))+
  geom_boxplot()

```

Nesta analise procurei fazer uma avaliação identificardas contribuições ocorreram ao longo do período. Primeiro considerei todo o período do dataset e então fiz uma analise focada em 2016, ano da eleição. 

```{r Distribuição das doações ao longo do periodo, echo=FALSE, warning=FALSE}
summary(USACampaign$contb_receipt_date)

ggplot(aes(x = contb_receipt_dt_year), data = USACampaign)+
  geom_histogram(stat = 'count')+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  ggtitle('Distribuição das contribuições por ano')

ggplot(aes(x = contb_receipt_dt_month), data = USACampaign)+
  geom_histogram(stat = 'count')+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  facet_wrap( ~contb_receipt_dt_year, ncol = 4)+
  ggtitle('Distribuição das contribuições por mes')

#Freqpoly das contribuições em todo periodo considerando um binwidth de 7 (1 semana)
g <- ggplot(aes(x = contb_receipt_date), data = USACampaign)+
  geom_freqpoly(binwidth=7)+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

g+
  scale_x_date(date_breaks = "3 months", 
               date_minor_breaks = "1 months", 
               date_labels = "%b/%Y",
               limits = as.Date(c("2013-10-01","2016-12-31")))+
  ggtitle('Distribuição das contribuições no período')

#Freqpoly das contribuições no ano de 2016 considerando um binwidth de 7 (1 semana)
g+
  scale_x_date(date_breaks = "1 months", 
               date_labels = "%b/%Y",
               limits = as.Date(c("2016-01-01","2016-12-31")))+
  ggtitle('Distribuição das contribuições no período em 2016')
```

Em uma análise da distribuição dos valores de contribuições já podemos perceber como as contribuições de menores valores são a maioria em quantidade, como já se era de esperar.

```{r Distribuição das contribuições por valor, echo = FALSE, warning=FALSE}

ggplot(aes(x=contb_receipt_amt), 
       data = USACampaign)+
  geom_histogram(binwidth = 100)+
  scale_x_continuous(breaks = seq(0, 15000, 2500))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Para uma analise de um espectro maior de valores, reduzi o binwidth em 10x. Na sequência apliqei uma escala logaritima para exibir melhor o valores com menos contribuuções e reduzi o limite do eixo x com o objetivo de focar nos valores de contribuições mais frequentes, chegando no limite de um quartil de 95%.

```{r Distribuição das contribuições por valor 2, echo = FALSE, warning=FALSE}
g <- ggplot(aes(x=contb_receipt_amt), 
       data = USACampaign)+
  geom_histogram(binwidth = 10)+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Exibe o primeiro grafico
g +
  scale_x_continuous(breaks = seq(0, 15000, 2500))

summary(USACampaign$contb_receipt_amt)

#Aplica a escola logaritimica no grafico anterior
g +
  scale_x_continuous(breaks = seq(0, 15000, 2500))+
  scale_y_log10(breaks=c(10, 100, 1000, 10000, 100000))
  
#Removendo os outliers
quantile(USACampaign$contb_receipt_amt, 0.95)

ggplot(aes(x = contb_receipt_amt), 
       data = USACampaign)+
  geom_histogram(binwidth = 1)+
  scale_x_continuous(limits = c(0, quantile(USACampaign$contb_receipt_amt, 0.95)), 
                     breaks = seq(0, quantile(USACampaign$contb_receipt_amt, 0.95), 50))+
  scale_y_log10(breaks=c(10, 100, 1000, 10000, 100000))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Decidi classificar os valores de contribuição considerando as seguintes faixas de valores:
- Até 100,00
- 100,01 a 500,00
- 500,01 a 2.000,00
- Acima de 2.000,00

```{r echo=FALSE, warning=FALSE}
# Cria faixa para os valores de contribuição
USACampaign$contb_receipt_amt_range <- cut(USACampaign$contb_receipt_amt, c(0,100,500,2000,max(USACampaign$contb_receipt_amt)))

ggplot(aes(x=contb_receipt_amt_range), 
       data = USACampaign)+
  geom_bar(stat = 'count')+
  scale_y_continuous(breaks=seq(0,600000,50000))+
  scale_x_discrete(labels=c("Até 100","100-500","500-2000","Acima de 2000"))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```


```{r Distribuição das contribuições na 30 maiores cidades, echo = FALSE, warning = FALSE}

USACampaign.by_city <- USACampaign %>%
                      group_by(city) %>%
                      summarise(count = n()) %>%
                      arrange(desc(count))

head(USACampaign.by_city, 30)

top30_city <- head(USACampaign.by_city, 30)$city

# Ordena as cidades com base na quantidade de contribuições
USACampaign$city_ordered <- factor(USACampaign$city, USACampaign.by_city$city)

# Distribuição das contribuições entre as cidades com mais contribuições
ggplot(aes(x=city_ordered), 
       data = subset(USACampaign, city %in% top30_city))+
  geom_bar(stat = 'count')+
  scale_y_continuous(breaks=seq(0, 70000, 10000), minor_breaks = seq(0, 75000, 2500))+
  xlab("Cidades do estado do TX")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


```{r Distribuicao por ocupação, echo=FALSE}

USACampaign.by_occupation <- USACampaign %>%
                      group_by(contbr_occupation) %>%
                      summarise(count = n()) %>%
                      arrange(desc(count))

head(USACampaign.by_occupation, 10)

top10_occupation <- head(USACampaign.by_occupation, 10)$contbr_occupation

# Ordena as cidades com base na quantidade de contribuições
USACampaign$occup_ordered <- factor(USACampaign$contbr_occupation, USACampaign.by_occupation$contbr_occupation)

# Distribuição das contribuições entre as cidades com mais contribuições
ggplot(aes(x=occup_ordered), 
       data = subset(USACampaign, contbr_occupation %in% top10_occupation))+
  geom_bar(stat = 'count')+
  xlab("Cidades do estado do TX")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  ggtitle('Distribuição das contribuições por candidato entre as 10 principais ocupações do contribuintes')
```

# Análise Univariada

### Qual é a estrutura do conjunto de dados?

O conjunto de dados possui  registros de contribuições para o estado de TX, com 28 atributos no arquivo tratado e 18 no arquivo original.

### Quais são os principais atributos de interesse deste conjunto de dados?

Os principais atributos deste conjunto de dados são os candidatos (*cand_nm*) e os valores das contribuições (*contb_receipt_amt*).

### Quais outros atributos você acha que podem lhe auxiliar na investigação destes atributos de interesse?

Atributos realcionados a origem das contribuições serão muito úteis nesta analise. Entre elas estão:

- Nome do comite
- Nome do contribuinte
- Data de contribuição
- Ocupação do contribuinte
- Cidade do contribuinte

Além destas existem variáveis importantes como o partido do candidato.

### Você criou novas variáveis a partir dos atributos existentes no conjunto de dados?

Sim. Foram criados as seguintes variaveis: 
- A partir da data, criei colunas com os componentes da data de contribuição (dia, mês e ano)
- Foram incorporados dados do dataset de CEP (zipcode): cidade, longitude e latitude 
- Foi adicionada uma coluna com faixas dos valores doados.
- A partir da base de dados dos candidatos (obtido na FEC), foi incorporado o partido do candidato
- A partir da base de dados dos comites (obtido na FEC), foi incorporado o nome do comite

### Dos atributos investigados, distribuições incomuns foram encontradas? Você aplicou operações nos dados para limpá-los, ajustá-los ou mudar a forma dos dados? Se sim, por quê?

Foram realizados tratamentos nos valores de contribuição. Para os valores negativos, foi considerado o valor absoluto. As contribuições zeradas foram eliminadas.

As datas de contribuição carregadas originalmente como `caracter`, foram convertidas para `Date` e quebrada em colunas separadas para dia, mes e ano.

Conforme apresentado na seção de tratamento de dados, fiz uma ajuste nos nomes das cidades para eleminar as cidades iguais registradas com grafias diferentes. O mesmo tratamento foi realizado para a ocupação dos contribuintes.

Todos os tratamentos foram realizados num script python a parte (`tratarDados.py`).

# Seção de Gráficos Bivariados

Aqui fiz uma analise das distriuição dos valores ao longo do tempo. No primeiro gráfico foi feita uma analise mais ampla por todo o período compreendido no dataset. No segundo reduzi o faixa de valores para o ano de 2016 e foi considerada as contribuições realizadas dentro de 99% da amostragem.

```{r Valores de contrbuição ao longo do tempo, echo = FALSE}

g <- ggplot(aes(x = contb_receipt_date, y = contb_receipt_amt), 
       data = USACampaign)+
  geom_point(alpha = 1/100, position = 'jitter', color = 'orange')+
  geom_smooth()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  ggtitle('Distribuição das contribuições no período')

g+
  scale_x_date(date_breaks = "2 months", 
               date_minor_breaks = "1 months", 
               date_labels = "%b/%Y")+
  scale_y_continuous(breaks = seq(0, 17500, 1000))

g+
  scale_x_date(date_breaks = "1 months", 
               date_labels = "%b/%Y",
               limits = as.Date(c("2016-01-01","2016-12-31")))+
  scale_y_continuous(breaks = seq(0, 6000, 500), limits = c(0, quantile(USACampaign$contb_receipt_amt, 0.99)))

```

Nesta analise podemos perceber a presença de faixas horizontais bem definidas para os valores doados com mais frequncias. Estes normalmente ão valores redodndos. Uma faixa bem definida é a 2700 dolares, que era o limite máximo permitido para pessoas físicas [Limites de contribuições - FEC](https://transition.fec.gov/info/contriblimitschart1516.pdf). Considerando eleições primárias e geral, é possível uma doação de $5.400,00 (2.700 para cada).

Estas mesmas faixas podem ser percebidas quando analisamos a os valores de contribuição por candidato, como visto abaixo.

```{r Valor de contibuições para cada candidato, echo=FALSE}
ggplot(aes(x=cand_nm, y=contb_receipt_amt), data=USACampaign)+
  geom_point()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

g <- ggplot(aes(x=cand_nm, y=contb_receipt_amt), data=USACampaign)+
  geom_point(alpha = 1/50, position = 'jitter')+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

g+scale_y_continuous(breaks = seq(0, 20000, 1000))

g+scale_y_continuous(limits = c(0, quantile(USACampaign$contb_receipt_amt, 0.99)),
                     breaks = seq(0, 3000, 250))

```

Nesta sequencia de gráficos vemos as relações entre candidatos e valores de contribuição. Ao contrário do que normalmente seria esperado, o candidato com mais contribuições não é o mesmo com maior valor arrecadado. O candidato **Jeb Bush**, apesar de possuir menos de 5% das contribuições de **Bernard Sanders**, conseguiu arrecadar um pouco que o este. No caso especial de Jeb Bush, isto pode ter relação com o fato do Texas ser o seu estado Natal, além da sua  relação com os outros 2 ex-presidentes Bush (pai e irmão).

```{r Valor médio das contribuições, echo=FALSE}

plot_candidato <- function(df, campo, titulo = '') {
  ggplot(aes(x=cand_nm, y=campo), data = df)+
    geom_bar(stat = 'identity', fill = I('#99AAFF'))+
    ggtitle(titulo)+
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

df <- subset(agrupado_por_candidato(), cand_nm %in% top7_cand)

df

plot_candidato(df, df$qtde, 'Qtde de contribuições por candidato')
plot_candidato(df, df$valor_total, 'Valor total por candidato')
plot_candidato(df, df$valor_medio, 'Valor médio por candidato')

```

Um comportamento semelhante pode ser observado quando analisamos os 2 principais partidos (Democratas e Republicanos). Embora os democratas tenham uma quantidade de contribuições maior do que a dos republicanos (feitas principalmente em nome de Hillary Cinton), o valor arreacadado do segundo é quase o dobro do primeiro.

```{r Distribuição das contribuições por partido e candidato, echo = FALSE}

ggplot(aes(x=party, fill = cand_nm), 
       data = USACampaign.rep_and_dem)+
  geom_bar(stat = 'count')+
  scale_y_continuous(breaks = seq(0, 300000, 25000))+
  xlab("Partidos")+
  ylab("Quantidade de contribuições")+
  ggtitle('Distribuição das contribuições por partido')+
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="bottom")

ggplot(aes(x=party, y=contb_receipt_amt, fill = cand_nm), 
       data = USACampaign.rep_and_dem)+
  geom_bar(stat = 'sum')+
  scale_y_continuous(breaks = seq(0, 2000000, 200000))+
  xlab("Partidos")+
  ylab("Valor total das contribuições")+
  ggtitle('Valor total do financiamento por partido')+
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="bottom")

```

Na distribuição das doações entre as cidades do estado do TX, temos Austin em segundo, atrás apenas da cidade de Houston, porém quando analisamos o valor total, Dallas vem em segundo, deixando Austin em terceiro. Isto poderia estar relacionada a renda media de cada cidade mas sem os dados de rendimentos não é possível esta analise.

```{r Distribuição das contribuições na 30 maiores cidades por partido, echo = FALSE, warning = FALSE}

# Distribuição das contribuições entre as cidades com mais contribuições por partido
ggplot(aes(x=city_ordered, fill=party), 
       data = subset(USACampaign, city %in% top30_city))+
  geom_bar(stat = 'count')+
  scale_y_continuous(breaks=seq(0, 70000, 10000), minor_breaks = seq(0, 75000, 2500))+
  xlab("Cidades do estado do TX")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

ggplot(aes(x=city_ordered, y=contb_receipt_amt, fill = party), 
       data = subset(USACampaign, city %in% top30_city))+
  geom_bar(stat = 'summary', fun.y = 'sum')+
  scale_y_continuous(breaks=seq(0, 70000, 10000), minor_breaks = seq(0, 75000, 2500))+
  xlab("Cidades do estado do TX")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Por fim fiz uma analise da distribuição geográfica das doações com base nas informações de longitude (`lon`) e latitude (`lat`) recolhidas na base de dados de zipcode.

Como esperado, a maioria das doação estão concentradas na parte leste do estado, onde se localizam as cidades com maior quantidade de contribuições: Houston, Austin e Dallas.

```{r Distribuição espacial das distribuições no estado do Texas, echo=FALSE}

#Distribuição espacial das contribuições
ggplot(aes(x = lon, y = lat),
       data = subset(USACampaign, !is.na(lon) &  !is.na(lat)))+
  geom_point(alpha = 0.01)+
  theme(legend.position="bottom")

#Distribuição espacial das contribuições no estado do TX
texas <- readShapeSpatial("tl_2017_48_cousub/tl_2017_48_cousub.shp")
summary(texas)

texas@data$color <- ifelse(texas@data$NAME %in% c("Houston","Dallas","Austin"), 'red', 'white')

plot(texas, border=gray(0.8), col = as.character(texas@data$color))
points(USACampaign$lon,USACampaign$lat,pch=18,col=I('#9999FF'))
```

# Análise Bivariada

### Discuta sobre alguns dos relacionamentos observados nesta parte da investigação. Como os atributos de interesse variaram no conjunto de dados?

### Você observou algum relacionamento interessante entre os outros atributos (os que não são de interesse)?

### Qual foi o relacionamento mais forte encontrado?



# Seção de Gráficos Multivariados

```{r echo=FALSE, Multivariate_Plots}
#set.seed(20022012)

ggplot(aes(x = lon, y = lat, color = cand_nm),
       data = subset(USACampaign, !is.na(city) & cand_nm %in% top7_cand))+
  geom_point(alpha = 0.05)
  #guides(color=FALSE)

```

# Análise Multivariada

### Discuta sobre os relacionamentos observados nesta parte da investigação. Quais atributos que fortaleceram os demais na observação das variáveis de interesse?

### Interações surpreendentes e/ou interessantes foram encontradas entre os atributos?

### OPCIONAL: Modelos foram criados usando este conjunto de dados? Discuta sobre os pontos fortes e as limitações do seu modelo.

------

# Gráficos Finais e Sumário

### Primeiro Gráfico
```{r echo=FALSE, Plot_One}

```

### Descrição do Primeiro Gráfico


### Segundo Gráfico
```{r echo=FALSE, Plot_Two}

```

### Descrição do Segundo Gráfico


### Terceiro Gráfico
```{r echo=FALSE, Plot_Three}

```

### Descrição do Terceiro Gráfico

------

# Reflexão

No início da análise dos dados tinha em mente fazer utilização apenas dos dados disponíveis no dataset. A partir dele comecei a fazer a análise das distribuição de valores do estado de NY. Neste ponto me deparei com as questões citadas no início do documento, que me fizeram mudar minha análise para os dados de outro esttado, o Texas.

Durante as primeiras análises percebi que muitos dados necessitavam de trartamento e então resolvi preparar um script em Python para realizar alguns ajustes. Outra observação feita com inicio do trabalho, foi que a necessidade de mais dados para análise e exclusão de algumas informações desnecessárias no dataset.

DIFICULDADE COM MAPA

# Referências

Abaixo o link para referências usadas para este trabalho

- Detailed Files About Candidates, Parties and Other Committees - [FEC](http://classic.fec.gov/finance/disclosure/ftpdet.shtml)

- Arquivo SHP das cidades do estado do Texas - [United States Census](https://www.census.gov/geo/maps-data/data/cbf/cbf_cousub.html)

- Limites de contribuições por candidato - [FEC](https://transition.fec.gov/info/contriblimitschart1516.pdf)

